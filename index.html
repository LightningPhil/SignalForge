<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Signal Processor v5.0</title>
    
    <!-- Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.3.0/math.min.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>

    <div class="app-container">
        <header>
            <h1>Signal Processor</h1>
            <nav>
                <button id="btn-load-file">üìÇ Load</button>
                <button id="btn-view-grid">üìÖ Grid</button>
                <button id="btn-reference-grid">üìê Reference</button>
                <button id="btn-graph-config">‚öôÔ∏è Graph</button>
                <button id="btn-export">üíæ Export</button>
                <button id="btn-help">‚ùì Help</button>
                <button id="btn-theme-toggle" class="theme-toggle" aria-pressed="false" title="Toggle light or dark appearance">
                    <span class="theme-icon">üåô</span>
                    <span class="theme-label">Dark Mode</span>
                </button>
            </nav>
        </header>

        <main>
            <!-- Sidebar -->
            <aside class="controls">
                
                <div class="panel">
                    <h3>Filter Pipeline</h3>
                    <div class="checkbox-row" style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;">
                        <label for="chk-sync-tabs" class="toggle-label" style="margin:0;">
                            <input type="checkbox" id="chk-sync-tabs" checked>
                            Sync All Tabs
                        </label>
                        <small style="color:#aaa;">Apply this pipeline across every tab.</small>
                    </div>
                    <div id="pipeline-list"></div>
                    <div class="pipeline-actions">
                        <button id="btn-add-step" title="Add Step">‚ûï Add</button>
                        <button id="btn-remove-step" title="Remove Step">üóëÔ∏è</button>
                        <button id="btn-move-up" title="Move Up">‚¨ÜÔ∏è</button>
                        <button id="btn-move-down" title="Move Down">‚¨áÔ∏è</button>
                    </div>
                </div>

                <div class="panel" id="trace-selector-panel" style="display:none;">
                    <h3>Trace Selector</h3>
                    <p>Select which columns to display in this multi-view tab.</p>
                    <div id="trace-selector-list" class="checkbox-column"></div>
                </div>

                <div class="panel" id="param-editor">
                    <h3>Parameters</h3>
                    <div class="step-type-label" id="step-type-display">Select a step</div>
                    
                    <div id="filter-params">
                        
                        <!-- Window Size -->
                        <div id="group-window">
                            <label for="param-window">Window / Kernel</label>
                            <input type="number" id="param-window" value="5" min="1" step="2">
                            <div class="slider-group">
                                <input type="range" id="slider-window" min="1" max="101" step="2">
                            </div>
                            <small class="hint">Odd numbers only</small>
                        </div>

                        <!-- Polynomial Order -->
                        <div id="group-poly" style="display:none;">
                            <label for="param-poly">Poly Order</label>
                            <input type="number" id="param-poly" value="3" min="1" max="10">
                            <div class="slider-group">
                                <input type="range" id="slider-poly" min="1" max="6" step="1">
                            </div>
                        </div>

                        <!-- Iterations -->
                        <div id="group-iters" style="display:none;">
                            <label for="param-iters">Iterations</label>
                            <input type="number" id="param-iters" value="1" min="1" max="16">
                            <div class="slider-group">
                                <input type="range" id="slider-iters" min="1" max="16" step="1">
                            </div>
                        </div>

                        <!-- Alpha -->
                        <div id="group-alpha" style="display:none;">
                            <label for="param-alpha">Alpha</label>
                            <input type="number" id="param-alpha" value="0.1" min="0.001" max="1.0" step="0.01">
                            <div class="slider-group">
                                <input type="range" id="slider-alpha" min="0.001" max="1.0" step="0.001">
                            </div>
                        </div>

                        <!-- Sigma -->
                        <div id="group-sigma" style="display:none;">
                            <label for="param-sigma">Sigma</label>
                            <input type="number" id="param-sigma" value="1.0" min="0.1" step="0.1">
                            <div class="slider-group">
                                <input type="range" id="slider-sigma" min="0.1" max="20.0" step="0.1">
                            </div>
                        </div>

                        <!-- Decay Length -->
                        <div id="group-decay" style="display:none;">
                            <div class="checkbox-row" style="display:flex; gap:10px; margin-bottom:10px;">
                                <label style="display:flex; align-items:center; gap:6px;">
                                    <input type="checkbox" id="param-apply-start" checked>
                                    Apply Start Taper
                                </label>
                                <label style="display:flex; align-items:center; gap:6px;">
                                    <input type="checkbox" id="param-apply-end" checked>
                                    Apply End Taper
                                </label>
                            </div>

                            <label for="param-start-decay">Start Fade Length</label>
                            <input type="number" id="param-start-decay" value="50" min="0">
                            <div class="slider-group">
                                <input type="range" id="slider-start-decay" min="0" max="500" step="1">
                            </div>

                            <label for="param-end-decay">End Fade Length</label>
                            <input type="number" id="param-end-decay" value="50" min="0">
                            <div class="slider-group">
                                <input type="range" id="slider-end-decay" min="0" max="500" step="1">
                            </div>

                            <label for="param-start-offset">Start Offset</label>
                            <input type="number" id="param-start-offset" value="0" step="0.000001">

                            <div class="auto-offset-group">
                                <label class="toggle-label" for="param-auto-offset">
                                    <input type="checkbox" id="param-auto-offset">
                                    Auto Start Offset
                                </label>
                                <label for="param-offset-points">Auto Offset Sample Count</label>
                                <input type="number" id="param-offset-points" value="200" min="1">
                            </div>
                            <small class="hint">Automatically averages the first N points when enabled.</small>
                        </div>

                        <!-- Frequency Domain (No sliders for huge ranges usually) -->
                        <div id="group-freq" style="display:none;">
                            <label for="param-freq">Cutoff Frequency</label>
                            <div class="input-with-unit">
                                <input type="number" id="param-freq" value="100" min="0.1" step="0.1">
                                <select id="unit-freq">
                                    <option value="1">Hz</option>
                                    <option value="1000">kHz</option>
                                    <option value="1000000" selected>MHz</option>
                                    <option value="1000000000">GHz</option>
                                </select>
                            </div>
                        </div>

                        <div id="group-slope" style="display:none;">
                            <label for="param-slope">Slope (dB/Octave)</label>
                            <input type="number" id="param-slope" value="12" min="6" step="6">
                            <div class="slider-group">
                                <input type="range" id="slider-slope" min="6" max="96" step="6">
                            </div>
                        </div>

                        <div id="group-q" style="display:none;">
                            <label for="param-q">Q Factor</label>
                            <input type="number" id="param-q" value="0.707" min="0.1" step="0.01">
                            <div class="slider-group">
                                <input type="range" id="slider-q" min="0.1" max="10.0" step="0.1">
                            </div>
                        </div>

                        <div id="group-bw" style="display:none;">
                            <label for="param-bw">Bandwidth</label>
                            <div class="input-with-unit">
                                <input type="number" id="param-bw" value="1" min="0.1" step="0.1">
                                <select id="unit-bw">
                                    <option value="1">Hz</option>
                                    <option value="1000">kHz</option>
                                    <option value="1000000" selected>MHz</option>
                                    <option value="1000000000">GHz</option>
                                </select>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="panel" id="composer-panel" style="display:none;">
                    <h3>Jitter Correction</h3>
                    <div id="composer-list" class="composer-list"></div>
                </div>
            </aside>

            <section class="graph-container">
                <div class="tabs-container" id="tabs-wrapper">
                    <div id="column-tabs" class="tabs-container">
                        <div class="tab-placeholder">Load data to see columns</div>
                    </div>
                    <button id="btn-add-multiview" class="tab add-tab" title="Add Multi-View or Math Trace" aria-label="Add Multi-View or Math Trace">‚ûï</button>
                </div>

                <div class="graph-toolbar">
                    <div class="tool-group">
                        <label class="toggle-label"><input type="checkbox" id="live-show-raw" checked> Raw</label>
                    </div>
                    <div class="tool-group" id="container-opacity">
                        <label>Opacity</label>
                        <input type="range" id="live-raw-opacity" min="0" max="1" step="0.05" value="0.5">
                    </div>
                    <div class="tool-group tool-divider">
                        <label class="toggle-label"><input type="checkbox" id="live-show-diff"> Diff</label>
                    </div>
                    <div class="tool-group tool-divider">
                        <label class="toggle-label"><input type="checkbox" id="live-freq-domain"> Freq Domain (FFT)</label>
                    </div>
                    <div class="tool-item" style="margin-left: auto;">
                        <span id="live-status" style="font-size: 0.8em; color: var(--text-muted);">Ready</span>
                    </div>
                </div>

                <div id="main-plot"></div>
            </section>
        </main>
    </div>

    <input type="file" id="file-input" accept=".csv,.txt" style="display: none;">
    <script type="module" src="src/main.js"></script>
</body>
</html>